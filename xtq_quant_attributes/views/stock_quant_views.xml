<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--
            Vista de lista INDEPENDIENTE para stock.quant.
            Esta vista se usa exclusivamente cuando se accede desde el botón "Stock por Atributos".
            Define una base limpia sobre la cual la lógica de Python inyectará las columnas dinámicas.
        -->
        <record id="view_stock_quant_list_with_attributes" model="ir.ui.view">
            <field name="name">stock.quant.list.with.attributes.base</field>
            <field name="model">stock.quant</field>
            <field name="arch" type="xml">
                <!-- Se añade js_class para que el renderer de JS tome el control -->
                <list js_class="stock_quant_list_with_attributes">
                    <field name="product_id" optional="hide"/>
                    <field name="lot_id"/>
                    <field name="location_id"/>
                    <field name="quantity"/>
                    <field name="product_uom_id"/>
                    <!-- Campos genéricos. JS decidirá si se muestran y con qué etiqueta. -->
                    <field name="x_attr_1" optional="hide"/>
                    <field name="x_attr_2" optional="hide"/>
                    <field name="x_attr_3" optional="hide"/>
                    <field name="x_attr_4" optional="hide"/>
                    <field name="x_attr_5" optional="hide"/>
                    <field name="x_attr_6" optional="hide"/>
                </list>
            </field>
        </record>

        <!-- Inherit standard stock quant list (simple) used in pick_from to inject attrs cols and JS -->
        <record id="view_stock_quant_tree_simple_inherit_xtq_attrs" model="ir.ui.view">
            <field name="name">stock.quant.list.simple.inherit.xtq.attrs</field>
            <field name="model">stock.quant</field>
            <field name="inherit_id" ref="stock.view_stock_quant_tree_simple"/>
            <field name="arch" type="xml">
                <xpath expr="//list" position="attributes">
                    <attribute name="js_class">stock_quant_list_with_attributes</attribute>
                </xpath>
                <xpath expr="//field[@name='lot_properties']" position="after">
                    <field name="x_attr_1" optional="hide"/>
                    <field name="x_attr_2" optional="hide"/>
                    <field name="x_attr_3" optional="hide"/>
                    <field name="x_attr_4" optional="hide"/>
                    <field name="x_attr_5" optional="hide"/>
                    <field name="x_attr_6" optional="hide"/>
                </xpath>
            </field>
        </record>

        <!-- Inherit standard stock quant list (primary) to inject cols (conservative: keep existing js_class) -->
        <record id="view_stock_quant_tree_inherit_xtq_attrs" model="ir.ui.view">
            <field name="name">stock.quant.list.inherit.xtq.attrs</field>
            <field name="model">stock.quant</field>
            <field name="inherit_id" ref="stock.view_stock_quant_tree"/>
            <field name="arch" type="xml">
                <!-- No cambiamos js_class aquí para no afectar otras funcionalidades globales -->
                <xpath expr="//field[@name='lot_properties']" position="after">
                    <field name="x_attr_1" optional="hide"/>
                    <field name="x_attr_2" optional="hide"/>
                    <field name="x_attr_3" optional="hide"/>
                    <field name="x_attr_4" optional="hide"/>
                    <field name="x_attr_5" optional="hide"/>
                    <field name="x_attr_6" optional="hide"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
