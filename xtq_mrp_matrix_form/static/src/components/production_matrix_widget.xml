<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <t t-name="xtq_mrp_matrix_form.ProductionMatrixWidget" owl="1">
        <div class="o_production_matrix table-responsive">
            <t t-if="state.error">
                <div class="alert alert-danger" role="alert" t-esc="state.error"/>
            </t>

            <t t-elif="state.axis_x &amp;&amp; state.axis_x.values &amp;&amp; state.axis_y &amp;&amp; state.axis_y.values &amp;&amp; state.axis_x.values.length > 0 &amp;&amp; state.axis_y.values.length > 0">
                <div class="o_field_x2many_list_container">
                <table class="o_list_table table table-sm table-hover table-striped w-100">
                    <thead>
                        <tr>
                            <th style="min-width: 120px;" t-esc="state.axis_y.name + ' \\ ' + state.axis_x.name"/>
                            <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                <th class="text-center" t-esc="x_val.name"/>
                            </t>
                            <th class="text-center" style="min-width: 100px;">Total</th>
                        </tr>
                         <tr>
                            <th>Proporci√≥n</th>
                             <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                 <th class="text-center" t-esc="x_val.proportion || '0'"/>
                             </t>
                             <th/>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="state.axis_y.values" t-as="y_val" t-key="y_val.id">
                            <tr>
                                <td t-esc="y_val.name"/>
                                <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <input type="number" class="o_input text-center flex-grow-1" min="0" step="1"
                                                t-att-value="getQuantity(y_val.id, x_val.id, 'qty_producing')"
                                                t-on-change="(ev) => _onQtyProducingChange(ev, y_val.id, x_val.id)"
                                                t-att-readonly="!isQtyProducingEditable() || null"/>
                                            <span class="px-1">/</span>
                                            <input type="number" class="o_input text-center flex-grow-1" min="0" step="1"
                                                t-att-value="getQuantity(y_val.id, x_val.id, 'product_qty')"
                                                t-on-change="(ev) => _onProductQtyChange(ev, y_val.id, x_val.id)"
                                                t-att-readonly="!isProductQtyEditable() || null"/>
                                        </div>
                                    </td>
                                </t>
                                <td class="text-center table-secondary">
                                    <strong>
                                        <t t-esc="state.totals.rows[y_val.id].qty_producing"/> / <t t-esc="state.totals.rows[y_val.id].product_qty"/>
                                    </strong>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                    <tfoot>
                        <tr class="table-secondary">
                            <td><strong>Total</strong></td>
                            <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                <td class="text-center">
                                    <strong>
                                        <t t-esc="state.totals.cols[x_val.id].qty_producing"/> / <t t-esc="state.totals.cols[x_val.id].product_qty"/>
                                    </strong>
                                </td>
                            </t>
                            <td class="text-center table-primary">
                                <strong>
                                    <t t-esc="state.totals.grand_total.qty_producing"/> / <t t-esc="state.totals.grand_total.product_qty"/>
                                </strong>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            </t>
        </div>
    </t>
</templates>