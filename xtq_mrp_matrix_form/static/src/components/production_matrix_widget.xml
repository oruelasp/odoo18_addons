<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <t t-name="xtq_mrp_matrix_form.ProductionMatrixWidget" owl="1">
        <div class="o_production_matrix table-responsive">
            <t t-if="state.error">
                <div class="alert alert-danger" role="alert" t-esc="state.error"/>
            </t>

            <t t-elif="state.axis_x &amp;&amp; state.axis_x.values &amp;&amp; state.axis_y &amp;&amp; state.axis_y.values &amp;&amp; state.axis_x.values.length > 0 &amp;&amp; state.axis_y.values.length > 0">
                <table class="table table-bordered table-sm o_matrix_table">
                    <thead>
                        <!-- Primera fila de cabecera: Eje Y vs Eje X -->
                        <tr class="bg-light">
                            <th class="o_matrix_header_cell">
                                <t t-esc="state.axis_y.name"/> \ <t t-esc="state.axis_x.name"/>
                            </th>
                            <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                <th class="text-center" t-esc="x_val.name"/>
                            </t>
                            <th class="text-center">Total</th>
                        </tr>
                        <!-- Segunda fila de cabecera: Proporción por columna (axis_x) -->
                        <t t-if="state.axis_x.values[0] &amp;&amp; state.axis_x.values[0].proportion !== undefined">
                            <tr class="bg-light">
                                <th class="o_matrix_header_cell">Proporción</th>
                                <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                    <th class="text-center" t-esc="x_val.proportion"/>
                                </t>
                                <th class="text-center"></th>
                            </tr>
                        </t>
                    </thead>
                    <tbody>
                        <t t-foreach="state.axis_y.values" t-as="y_val" t-key="y_val.id">
                            <tr>
                                <th class="bg-light">
                                    <t t-esc="y_val.name"/>
                                </th>
                                <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                    <td>
                                        <strong>
                                            <t t-esc="state.totals.rows[y_val.id].qty_producing"/> / <t t-esc="state.totals.rows[y_val.id].product_qty"/>
                                        </strong>
                                    </td>
                                </t>
                                <th class="text-center bg-light fw-bold" t-esc="state.rowTotals[y_val.id] || 0"/>
                            </tr>
                        </t>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td><strong>Total</strong></td>
                            <t t-foreach="state.axis_x.values" t-as="x_val" t-key="x_val.id">
                                <td>
                                    <strong>
                                        <t t-esc="state.totals.cols[x_val.id].qty_producing"/> / <t t-esc="state.totals.cols[x_val.id].product_qty"/>
                                    </strong>
                                </td>
                            </t>
                            <td class="table-primary">
                                <strong>
                                    <t t-esc="state.totals.grand_total.qty_producing"/> / <t t-esc="state.totals.grand_total.product_qty"/>
                                </strong>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </t>
        </div>
    </t>
</templates>